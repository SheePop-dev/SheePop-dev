<html style="background:#660000; overflow: hidden">
<head>
  <title>SheePop vs. Zarel</title>
  <link rel="icon" type="image/png" href="https://cdn.discordapp.com/attachments/311333557757018112/1212491182370983967/android-chrome-256x256.png?ex=65f20768&is=65df9268&hm=b34ffedad9414886dc32b47ed13d7ee5059f9ee3de4b4a1ea3e88f87974e9447&" />
  <meta name="twitter:title" content="SheePop vs. Zarel">
  <meta name="twitter:description" content="The mad King Zarel has taken over the land! Can you help SheePop defeat him before it's too late?">
  <meta name="twitter:image" content="https://cdn.discordapp.com/attachments/311333557757018112/1212491182370983967/android-chrome-256x256.png?ex=65f20768&is=65df9268&hm=b34ffedad9414886dc32b47ed13d7ee5059f9ee3de4b4a1ea3e88f87974e9447&">
</head>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<span id="content">
<div id="controls">
  <button class="direction" id="up" onClick="move(0)">⇧</button>
  <button class="direction" id="down" onClick="move(3)">⇩</button>
  <button class="direction" id="left" onClick="move(1)">⇦</button>
  <button class="direction" id="right" onClick="move(2)">⇨</button>
  <button class="direction" id="z" onClick="move(4)">Z</button>
</div>

  <!-- Assets -->
  <img width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1209548253079801907/iMarkup_20240220_171215.png?ex=65e75297&is=65d4dd97&hm=27ba4fdb037782f0de4dc0806e10dfc3544b96531f3757908cfa9410a4e8228a&;">
  <img id="relicanth" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1208102928376926319/IMG_20240216_1125421162.jpg?ex=65e21087&is=65cf9b87&hm=b5d29fb825047bf24e938f909a1666f3e14d864cd8d48d03eb696e465570e37b&;">
  
  <!-- Meme images -->
  <img id="meme0" width="0" src="https://cdn.discordapp.com/attachments/311333557757018112/1190073170661736448/Screenshot_20231228-172537-477.png?ex=65ea4d02&is=65d7d802&hm=1fc4c0341255918edde024ad4c591535a537ff5d1de69040bcd3f2cfdeab41f6&">
  <img id="meme1" width="0" src="https://media1.tenor.com/m/PGGxO_hD-5EAAAAC/i-just.gif">
  <img id="meme2" width="0" src="https://cdn.discordapp.com/attachments/311333557757018112/1174483404142690386/648328673576878114.png?ex=65e8f4e8&is=65d67fe8&hm=7ff23e17576bfb3680714fd6da756299554b77f36bb21733230e96ded24de6a2&">
  <img id="meme3" width="0" src="https://cdn.discordapp.com/attachments/311333557757018112/1173386895183589546/IMG_20231112_161725551_MP2.jpg?ex=65ee3234&is=65dbbd34&hm=2cd78dcb406737c0f2d105c451db17b18395d93221417a926a4b4abf85d8b75c&">
  <img id="meme4" width="0" src="https://cdn.discordapp.com/attachments/311333557757018112/1168694057548120124/Screen_Shot_2023-10-30_at_6.13.41_PM.png?ex=65ef94a8&is=65dd1fa8&hm=6d621a9a20b3044ba6c776d2f1f405dbedb602812f713b0e21288ba9ab9095f2&">
  <img id="meme5" width="0" src="https://cdn.discordapp.com/attachments/311333557757018112/1136021822228418682/IMG_20230801_144436499_HDR.jpg?ex=65e77644&is=65d50144&hm=f1fe704580330f332c464c43a557fc10f9211b1f43a609315d23c604039d33c5&">
  <img id="meme6" width="0" src="https://cdn.discordapp.com/attachments/311333557757018112/1135585227029348373/IMG_20230731_094920034.jpg?ex=65ef1a28&is=65dca528&hm=b9e7290d5e49cd0543a9a672cf4483e203fbcdb3ca8ffc5bfa480859837b8c8b&">
  <img id="meme7" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1209585793337925632/IMG_20240220_134108011_HDR2.jpg?ex=65e7758e&is=65d5008e&hm=f3cba7498f2ef8de291777f3924e243f25eecc69f159f0e128b9306a6892670d&">
  <img id="meme8" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1208477648439869500/image0.gif?ex=65eca803&is=65da3303&hm=258521998f1ac72f7a83eeb2194d5839cd8287f7e4646c304776aff2d8d33afc&">
  <img id="meme9" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1207668360423276584/image0.png?ex=65e9b64e&is=65d7414e&hm=a527806a48aface459d7980dd0b8fde65d9eaccbb45a990692f3f1950b6727fd&">
  <img id="meme10" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1207370890158018641/2023_09_21_0qk_Kleki.png?ex=65e8a144&is=65d62c44&hm=43464d34ca111811d31a8f10a937981b5db5ef3726ce8dbdbe745048cc8ab490&">
  <img id="meme11" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1204093670018781184/iMarkup_20240205_155756.png?ex=65ef2a1d&is=65dcb51d&hm=f183a28b25551aea41b444042e7e18c65dbdc38dc703d13e32fc84ea9c4f717e&">
  <img id="meme12" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1200127904462405703/Screenshot_20240125-111936-415.png?ex=65e9f735&is=65d78235&hm=82a93d052ba2e4df64a280f8b76674b507a7c5e9cd0d273f9115a480f0a7d65c&">
  <img id="meme13" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1189306908255993915/Screen_Shot_2019-12-07_at_11.17.05_PM.png?ex=65e7835f&is=65d50e5f&hm=7eed49cd84db6db81071aad9547aea7facb922d668eac56bc59f728a3d46808b&">
  <img id="meme14" width="0" src="https://media1.tenor.com/m/IXcAfMNnsBMAAAAC/crocodile-explosion.gif">
  <img id="meme15" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1184575271479812147/Screenshot_20231213-1316032.png?ex=65e8c1b1&is=65d64cb1&hm=f969bd5cec6f88493117585782509c9270a0f770a86e3a9d7b32136fa097219a&">
  <img id="meme16" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1179886603800412190/IMG_20231130_1446064452.jpg?ex=65ea2807&is=65d7b307&hm=d2cd2f21ec4061997b0df772d0b022c5aca41f0512fecea1ff12bdfed8fad462&">
  <img id="meme17" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1208102928376926319/IMG_20240216_1125421162.jpg?ex=65e21087&is=65cf9b87&hm=b5d29fb825047bf24e938f909a1666f3e14d864cd8d48d03eb696e465570e37b&;">

  
  <img id="sword" style="image-rendering: pixelated;" src="https://cdn.discordapp.com/attachments/311333557757018112/1212073575201251328/ezgif-2-59d9dca709.png?ex=65f0827b&is=65de0d7b&hm=af5b47e9f8aa27b5c8f965a85e9a8113571a3cf27df065f7b3d7f40c0ff36f36&" width="0">
  
  <img id="swipe" style="image-rendering: pixelated;" src="https://cdn.discordapp.com/attachments/311333557757018112/1212482732786188379/ezgif-4-3996d92036.png?ex=65f1ff8a&is=65df8a8a&hm=e011226b78b2683804d3b4720d0413014aadc7ff7e85a17b3a471db7a9376013&" width="0">
  
  <img id="player" style="image-rendering: pixelated;" src="https://cdn.discordapp.com/attachments/311333557757018112/1212446640796073984/ezgif-6-7f7c91ad89.png?ex=65f1dded&is=65df68ed&hm=1b4b93d43a19cbf7c2a5af573d7f131ff52583b3e70f9c28fe7310e91fa18be0&" width="0">
  
  <img id="hp_red" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1209610818233311283/2024_02_20_0zl_Kleki_1.png?ex=65e78cdc&is=65d517dc&hm=4ae9c11c9c4483895131e3860e733ac98da5763d19a9df3b795c6aa1ffe7631a&;">
  <img id="hp_black" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1209612689072984095/2024_02_20_0zs_Kleki.png?ex=65e78e9a&is=65d5199a&hm=323bcb25ed61f537b3918ca04d5b7dc66d97be221b09c5cb075ea339488755c7&;">
<!--
<img style="position: absolute; top: 580px; left: 315px; z-index: -2;" width="180" src="https://cdn.discordapp.com/attachments/1096317517754011658/1209610817906147328/2024_02_20_0zl_Kleki.png?ex=65e78cdc&is=65d517dc&hm=587c6447519bbee18d02301d2cd4f5dc3dc0d9d1217bd4479214df9db519e8dd&;">
-->
  <img id="heart_ace" style="position: absolute; top: 615px; left: -60px; z-index: -2;" width="60" src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/57/Playing_card_heart_A.svg/130px-Playing_card_heart_A.svg.png">
  <img id="coin" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1209580202250866788/2024_02_20_0ti_Kleki.png?ex=65e77059&is=65d4fb59&hm=1b6c7993702a94027e4298917c9530cda92a728ad0656467fba76fd48f664402&;">
  <img id="symbol_x" width="0" src="https://cdn.discordapp.com/attachments/1096317517754011658/1209587885251104768/2024_02_20_0x2_Kleki.png?ex=65e77780&is=65d50280&hm=2aba5967b6d3a2ad34135b0efa0c2e56442aff01f67ce77f92952071d36097e1&;"> 
 <canvas id="canvas"></canvas>
 <iframe src="https://github.com/anars/blank-audio/blob/master/250-milliseconds-of-silence.mp3" allow="autoplay" id="audio" style="display: none"></iframe>
</span>

<style>
#controls {
  position: fixed;
  bottom: 12px;
  color: white;
}
.direction {
  font-size:30px; 
  background: rgba(255,255,255,0.1);
  width:54px;
  height:54px;
  position: absolute;
  color: white;
}
#up {
  top: -144px;
  left: 72px;
}
#down {
  bottom: 24px;
  left: 72px;
}
#left {
  bottom: 58px;
  left: 12px;
}
#right {
  bottom: 58px;
  left: 132px;
}
#z {
  position: fixed;
  bottom: 64px;
  height: 64px;
  width: 64px;
  right: 24px;
}
</style>

<script>
(function () {
    var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
    window.requestAnimationFrame = requestAnimationFrame;
})();

function move(int) {
  if(int == 0) {
    keys[38] = true;
  } else if(int == 2) {
    keys[39] = true;
  } else if(int == 1) {
    keys[37] = true;
  } else if(int == 3) {
    keys[40] = true;
  } else if(int == 4) {
    keys[90] = true;
  }
}
	
var canvas = document.getElementById("canvas"),
  ctx = canvas.getContext("2d"),
  width = window.innerWidth,
  height = window.innerHeight,
  player = {
    gridX: 5,
    gridY: 2,
    x: 0,
    y: 0,
    width: 25,
    height: 25,
    speed: 3,
    velX: 0,
    velY: 0,
    hp: 5,
    maxHp: 5,
    canMove: true,
    jumping: false,
    invincible: false,
    grounded: false,
    color:'blue',
    draw: function () {
      ctx.drawImage("https://cdn.discordapp.com/attachments/1096317517754011658/1209548253079801907/iMarkup_20240220_171215.png?ex=65e75297&is=65d4dd97&hm=27ba4fdb037782f0de4dc0806e10dfc3544b96531f3757908cfa9410a4e8228a&;", this.x, this.y, this.size, this.size);
    }
  },
  keys = [],
  friction = 0.8,
  gravity = 0.4,
  boxes = [],
  powerup = [];  
  
const gridSize = 30;
const gridPosY = height / 1.6;
const gridWidth = 2;
const gridColor = "#000";

// dimensions

boxes.push({//box for the ground
  x: (width / 2) - gridSize*5,
  y: gridPosY + gridSize*3,
  width: gridSize*10 + gridWidth,
  height: gridWidth,
  color: gridColor
});

boxes.push({//box for the ground
  x: (width / 2) - gridSize*5,
  y: gridPosY + gridSize*2,
  width: gridSize*10 + gridWidth,
  height: gridWidth,
  color: gridColor
});

boxes.push({//box for the ground
  x: (width / 2) - gridSize*5,
  y: gridPosY + gridSize,
  width: gridSize*10 + gridWidth,
  height: gridWidth,
  color: gridColor
});

boxes.push({//box for the ground
  x: (width / 2) - gridSize*5,
  y: gridPosY,
  width: gridSize*10 + gridWidth,
  height: gridWidth,
  color: gridColor
});

boxes.push({//box for the ground
  x: (width / 2) - gridSize*5,
  y: gridPosY - gridSize,
  width: gridSize*10 + gridWidth,
  height: gridWidth,
  color: gridColor
});

boxes.push({//box for the ground
  x: (width / 2) - gridSize*5,
  y: gridPosY - gridSize*2,
  width: gridSize*10 + gridWidth,
  height: gridWidth,
  color: gridColor
});

boxes.push({//box for the ground
  x: (width / 2) - gridSize*5,
  y: gridPosY - gridSize*3,
  width: gridSize*10 + gridWidth,
  height: gridWidth,
  color: gridColor
});

boxes.push({//box for the top
  x: (width / 2) - gridSize*5,
  y: gridPosY - gridSize*4,
  width: gridSize*10 + gridWidth,
  height: gridWidth,
  color: gridColor
});

//--

boxes.push({//box for the right
  x: (width / 2) - gridSize*5,
  y: gridPosY - gridSize*4,
  width: gridWidth,
  height: gridSize*7,
  color: gridColor
});

boxes.push({//box for the left
  x: (width / 2) - gridSize*4,
  y: gridPosY - gridSize*4,
  width: gridWidth,
  height: gridSize*7,
  color: gridColor
});

boxes.push({//box for the left
  x: (width / 2) - gridSize*3,
  y: gridPosY - gridSize*4,
  width: gridWidth,
  height: gridSize*7,
  color: gridColor
});

boxes.push({//box for the left
    x: (width / 2) - gridSize*2,
    y: gridPosY - gridSize*4,
    width: gridWidth,
    height: gridSize*7,
    color: gridColor
});

boxes.push({//box for the left
    x: (width / 2) - gridSize,
    y: gridPosY - gridSize*4,
    width: gridWidth,
    height: gridSize*7,
    color: gridColor
});

boxes.push({//box for the left
    x: width / 2,
    y: gridPosY - gridSize*4,
    width: gridWidth,
    height: gridSize*7,
    color: gridColor
});

boxes.push({//box for the left
    x: (width / 2) + gridSize,
    y: gridPosY - gridSize*4,
    width: gridWidth,
    height: gridSize*7,
    color: gridColor
});

boxes.push({//box for the left
    x: (width / 2) + gridSize*2,
    y: gridPosY - gridSize*4,
    width: gridWidth,
    height: gridSize*7,
    color: gridColor
});

boxes.push({//box for the left
    x: (width / 2) + gridSize*3,
    y: gridPosY - gridSize*4,
    width: gridWidth,
    height: gridSize*7,
    color: gridColor
});

boxes.push({//box for the left
    x: (width / 2) + gridSize*4,
    y: gridPosY - gridSize*4,
    width: gridWidth,
    height: gridSize*7,
    color: gridColor
});

boxes.push({//box for the left
    x: (width / 2) + gridSize*5,
    y: gridPosY - gridSize*4,
    width: gridWidth,
    height: gridSize*7,
    color: gridColor
});

// -- 

boxes.push({//attack box
  x: (width / 2) - gridSize*2,
  y: gridPosY - gridSize*5 - 3,
  width: gridSize*4 + 3,
  height: gridWidth,
  color: 'green'
});

boxes.push({//attack box
  x: (width / 2) - gridSize*2,
  y: gridPosY - gridSize*4 - 3,
  width: gridSize*4 + 3,
  height: gridWidth,
  color: 'green'
});

boxes.push({//attack box
  x: (width / 2) - gridSize*2,
  y: gridPosY - gridSize*5 - 3,
  width: gridWidth,
  height: gridSize,
  color: 'green'
});

boxes.push({//attack box
  x: (width / 2) - gridSize*1,
  y: gridPosY - gridSize*5 - 3,
  width: gridWidth,
  height: gridSize,
  color: 'green'
});

boxes.push({//attack box
  x: (width / 2) - gridSize,
  y: gridPosY - gridSize*5 - 3,
  width: gridWidth,
  height: gridSize,
  color: 'green'
});

boxes.push({//attack box
  x: (width / 2),
  y: gridPosY - gridSize*5 - 3,
  width: gridWidth,
  height: gridSize,
  color: 'green'
});

boxes.push({//attack box
  x: (width / 2) + gridSize,
  y: gridPosY - gridSize*5 - 3,
  width: gridWidth,
  height: gridSize,
  color: 'green'
});

boxes.push({//attack box
  x: (width / 2) + gridSize*2,
  y: gridPosY - gridSize*5 - 3,
  width: gridWidth,
  height: gridSize,
  color: 'green'
});




player.x = boxes[13].x + 6;
player.y = boxes[5].y + 6;

canvas.width = width;
canvas.height = height;

var enemyAttacking = true;

var throwingCoin = false;
var throwingCards = false;

var coinCount = 0;
var coinSpeed = 20;
var coinsPlaced = false;

var attackCoords = [0,0];
var tempAttackCoords = [0,0];
var attackTurns = 0;
var attacking = false;
var attackGrid = 1;


var coinX = [];
var coinY = [];
var coinDestinationX = [];
var coinDestinationY = [];
var tempx = [];
var tempy = [];


// animations
var playerStepX = 0;
var playerStepY = 0;
var playerSpeed = 0;

var swordStepX = 0;
var swordStepY = 0;
var swordSpeed = 0;

var swipeStepX = 0;
var swipeStepY = 0;
var swipeSpeed = 0;


var swiping = false;
var hasSword = false;

var cardX = 0;
var cardY = 0;

var bossHp = 3;

function damagePlayer() {
  if (!player.invincible) {
    player.hp--;
    if (player.hp <= 0) {
      keys[90] = false;
      level = 2;
      if (soundOn) {
        audio0.pause();
      }
    }
  }
}

function defaults() {
  enemyAttacking = true;
  throwingCoin = false;
  throwingCards = false;
  coinCount = 0;
  coinSpeed = 20;
  coinsPlaced = false;
  attackCoords = [0,0];
  tempAttackCoords = [0,0];
  attackTurns = 0;
  attacking = false;
  attackGrid = 1;
  coinX = [];
  coinY = [];
  coinDestinationX = [];
  coinDestinationY = [];
  tempx = [];
  tempy = [];
  // animations
  playerStepX = 0;
  playerStepY = 0;
  playerSpeed = 0;
  swordStepX = 0;
  swordStepY = 0;
  swordSpeed = 0;
  swipeStepX = 0;
  swipeStepY = 0;
  swipeSpeed = 0;
  swiping = false;
  hasSword = false;
  cardX = 0;
  cardY = 0;
  bossHp = 3;
  score = 0;
  level = 0;
  selectedOption = 0;
  menu = 0;
  player.hp = player.maxHp;
  gridTiles = [[0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0]];
}


var score = 0;
var level = -2;
var selectedOption = 0;
var menu = 0;
var soundOn = true;

var randomImage = Math.floor(Math.random() * 17);


var gridTiles = [[0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0], [0,0,0,0,0,0,0]];


setTimeout(function() {
  level = -1;
}, 500);

function begin() {
  level = 0;
  if (soundOn) {
   audio.play();
  }
}

function update() {
  if (level == -1) {
    ctx.clearRect(0, 0, width, height);
    ctx.font = "18px Courier";
    ctx.fillStyle = "white";    
    ctx.fillText("Press [Z] to begin", (width/2) - (ctx.measureText("Press [Z] to begin").width/2), 80);
    if (keys[90]) {
      begin();
      keys[90] = false;
    }
  }

  ctx.imageSmoothingEnabled = false;
  if (level == 0) {
    if (keys[90] && player.canMove) { // Z
      keys[90] = false;
      if (menu == 0) {
        if(selectedOption == 0) {
          //toggleSound();
          level = 1;
          if (soundOn) {
            audio0.currentTime = 0;
            audio.pause();
            audio0.play();
          }
        }
        if(selectedOption == 1) {
          selectedOption = 0;
          menu = 1;
        }
      } else if(menu == 1) {
        if(selectedOption == 0) {
          if (soundOn) {
            soundOff();
            soundOn = false;
          } else {
            audio.play();
            soundOn = true;
          }
        }
        if(selectedOption == 1) {
          menu = 0;
          selectedOption = 0;
        }
      }
    }

        if (keys[38]) { // up
        	keys[38] = false;
			if (selectedOption == 1) {
            	selectedOption = 0;
            }
    	}

    	if (keys[40]) { // down
			keys[40] = false;
            if (selectedOption == 0) {
	            selectedOption = 1;
    		}        
    	}
        ctx.clearRect(0, 0, width, height);
        ctx.font = "74px Brush Script MT";
        ctx.fillStyle = "white";
        

        
        ctx.fillText("SheePop", (width/2) - (ctx.measureText("SheePop").width/2), 80);
        ctx.fillText("- vs -", (width/2) - (ctx.measureText("- vs -").width/2), 140);
        ctx.fillText("Zarel", (width/2) - (ctx.measureText("Zarel").width/2), 200);
        ctx.font = "24px Courier";
        if (menu == 0) {
			ctx.fillText("New Game", width/2 - 60, height/2);
        	ctx.fillText("Options", width/2 - 60, height/2 + 50);
        } else if (menu == 1) {
            if (soundOn) {
            	ctx.fillText("Sound:  On", width/2 - 60, height/2);
            } else {
            	ctx.fillText("Sound:  Off", width/2 - 60, height/2);
            }
            ctx.fillText("Back", width/2 - 60, height/2 + 50);
        }
        ctx.fill();//Draw charater stuff
    	ctx.fillRect(width/2 - 90, ((height/2) + (selectedOption * 50) -14), 16, 16);
        
    }  
    if (level == 1) {
    // check keys
    if (player.canMove) {
      if (keys[38] && player.gridY > 0) { // up
        if (gridTiles[player.gridX][player.gridY-1] == 0) {
          player.y -= gridSize;
          player.gridY--;
        }
        keys[38] = false;
      }
      if (keys[38] && attackGrid == 0 && player.gridX >= 3 && player.gridX <= 6 && player.gridY == 0) {
        useAttack();
        keys[38] = false;
      }
      
      if (keys[39] && player.gridX < 9) { // right
        if (gridTiles[player.gridX+1][player.gridY] == 0) {
          player.x += gridSize;
          player.gridX++;
        }
        keys[39] = false;
      }
      if (keys[37] && player.gridX > 0) { // left
        if (gridTiles[player.gridX-1][player.gridY] == 0) {
          player.x -= gridSize;
          player.gridX--;
        }
        keys[37] = false;
      }
      if (keys[40] && player.gridY < 6) { // down
        if (gridTiles[player.gridX][player.gridY+1] == 0) {
          player.y += gridSize;
          player.gridY++;
        }
        keys[40] = false;
      }
    }
    keys[37] = false;
    keys[38] = false;
    keys[39] = false;
    keys[40] = false;
    keys[90] = false;
  
  if (enemyAttacking) {
    if (!throwingCoin) {
      randomImage = Math.floor(Math.random() * 17);
      score++;
      if (!attacking) {
        if (attackTurns < 10) {
          attackTurns++;
        } else {
          if (bossHp == 3) {
            enemyAttacking = false;
          }
          if (!hasSword) {
            attack();
          }
        }
      }
  	  throwCoin();
    }
  }
    
  if (!throwingCards) {
    throwCard();
  }

    ctx.clearRect(0, 0, width, height);
    ctx.beginPath();
    
    player.grounded = false;
    
    ctx.drawImage(document.getElementById("meme" + randomImage), (width / 2) - 100, 20, 200, 160);
    
    ctx.drawImage(document.getElementById("heart_ace"),cardX-200 ,cardY-200, gridSize * 2, gridSize * 2);
    
    var i = 0;
    if (enemyAttacking) {
      for (i=0;i<coinCount;i++) {
        ctx.drawImage(document.getElementById("symbol_x"),coinDestinationX[i] + 1, coinDestinationY[i] + 1, gridSize, gridSize);
    	ctx.drawImage(document.getElementById("coin"),coinX[i] + 1, coinY[i] + 1, gridSize, gridSize);
      }
    }

    if (attacking) {
      if (bossHp == 3) {
        ctx.font = "18px Courier";
        ctx.fillStyle = "white";
        showText(["Here's your chance,","grab the sword!"]);
      }
      
      
     ctx.drawImage(document.getElementById("sword"), (swordStepX) * 30, (swordStepY) * 30, 30, 30, boxes[tempAttackCoords[0]].x + 2,boxes[tempAttackCoords[1]].y + 2, gridSize, gridSize);
      if (swordSpeed >= 4) {
        if (swordStepX == 1 && swordStepY == 3) {
          swordStepX = 0;
          swordStepY = 0;
        }
        if (swordStepX <= 3) {
          swordStepX++;
        } else {
          swordStepX = 0;
          if (swordStepY <= 3) {
            swordStepY++;
          } else {
            swordStepY = 0;
          }
        }
        swordSpeed = 0;
      }
      swordSpeed++;

      if(player.gridX == attackCoords[0] && player.gridY == attackCoords[1]) {
        grabSword();
        attacking = false;
      }
    }
    
    
    if (attackGrid == 0 && bossHp == 3) {
      ctx.fillStyle = "white";
      showText(["Now go to the green", "squares to attack!"]);
    }
       
    
    
    // Draw player HP
    var hpi;
    for (hpi = 0; hpi < player.maxHp; hpi++) {
      if (player.hp > hpi) {
        ctx.drawImage(document.getElementById("hp_red"), boxes[17].x - (gridSize * hpi) - gridSize*1.5, boxes[7].y - gridSize*3, gridSize*4, gridSize*3);
      } else {
        ctx.drawImage(document.getElementById("hp_black"), boxes[17].x - (gridSize * hpi) - gridSize*1.5, boxes[7].y - gridSize*3, gridSize*4, gridSize*3);
      }
    }
    
    //Draw boss hp
    var bhp;
    ctx.fillStyle = "orange";
    for (bhp = 0; bhp < bossHp; bhp++) {
      
      ctx.fillRect((width / 2) + 100, 25 + (50*bhp), 20, 45);
    }
    var boxesL = 8;
    if (attackGrid == 0) {
      boxesL = 0;
    } else {
      boxesL = 8;
    }
    for (var i = 0; i < boxes.length - boxesL; i++) {//print boxes
      ctx.fillStyle = boxes[i].color;
      ctx.fillRect(boxes[i].x, boxes[i].y, boxes[i].width, boxes[i].height);
        
    }


    ctx.fill();//Draw charater stuff
    ctx.fillStyle = player.color;
    
    
    
    
    
     ctx.drawImage(document.getElementById("player"), (playerStepX) * 30, (playerStepY) * 30, 30, 30, player.x - 3,player.y - 3, gridSize, gridSize);
      if (playerSpeed >= 12) {
        if (playerStepX == 0 && playerStepY == 1) {
          playerStepX = 0;
          playerStepY = 0;
        }
        if (playerStepX <= 3) {
          playerStepX++;
        } else {
          playerStepX = 0;
          if (playerStepY <= 0) {
            playerStepY++;
          } else {
            playerStepY = 0;
          }
        }
        playerSpeed = 0;
      }
      playerSpeed++;
    
    if (swiping) {
      ctx.drawImage(document.getElementById("swipe"), (swipeStepX) * 60, (swipeStepY) * 30, 60, 30, width/2 - 30,160, gridSize*2, gridSize);
      if (swipeSpeed >= 2) {
        if (swipeStepX == 1 && swipeStepY == 2) {
          swipeStepX = 0;
          swipeStepY = 0;
          swiping = false;
        }
        if (swipeStepX <= 3) {
          swipeStepX++;
        } else {
          swipeStepX = 0;
        if (swipeStepY <= 2) {
            swipeStepY++;
          } else {
            swipeStepY = 0;
          }
        }
        swipeSpeed = 0;
      }
      swipeSpeed++;
    }
  }	
  
  if (level == 2) {
    ctx.clearRect(0, 0, width, height);
    ctx.font = "36px Courier";
    ctx.fillStyle = "white";    
    ctx.fillText("Game Over", (width/2) - (ctx.measureText("Game Over").width/2), 120);
    
    ctx.font = "18px Courier";   
    ctx.fillText("Press [Z] to restart", (width/2) - (ctx.measureText("Press [Z] to restart").width/2), 160);
    
    
    if(keys[90]) {
      player.canMove = false;
      defaults();
      audio.currentTime = 0;
      audio.play();
      setTimeout(function() {
        player.canMove = true;
      }, 500);
    }
  }
  
   if (level == 10) {
    ctx.clearRect(0, 0, width, height);
    ctx.font = "36px Courier";
    ctx.fillStyle = "white";    
    ctx.fillText("You win!", (width/2) - (ctx.measureText("You win!").width/2), 120);
    
    ctx.font = "18px Courier";   
    
    ctx.fillText("Thank you for playing,", (width/2) - (ctx.measureText("Thank you for playing,").width/2), 160);
    
    ctx.fillText("more coming soon.", (width/2) - (ctx.measureText("more coming soon.").width/2), 200);
    
        ctx.fillText("Final score: " + score, (width/2) - (ctx.measureText("Final score: " + score).width/2), 300);
    
    ctx.fillText("Press [Z] to restart", (width/2) - (ctx.measureText("Press [Z] to restart").width/2), 500);
    
    
    if(keys[90]) {
      player.canMove = false;
      defaults();
      audio.currentTime = 0;
      audio.play();
      setTimeout(function() {
        player.canMove = true;
      }, 500);
    }
  }
  requestAnimationFrame(update);
}

function showText(arr) {
  var i = 0;
  var textPos = [48,220];
  for (i=0;i<arr.length;i++) {
    ctx.fillText(arr[i], textPos[0], textPos[1] + i*24);
  }
}

function attack() {
  attacking = true;
  if (player.gridX >= 5) {
    tempAttackCoords[0] = 8;
  } else {
    tempAttackCoords[0] = 17;
  }
  tempAttackCoords[1] = Math.floor(Math.random() * (7) + 1);
  
  attackCoords[0] = tempAttackCoords[0] - 8;
  attackCoords[1] = tempAttackCoords[1] - 1;
  attackCoords[1] = Math.abs(attackCoords[1] - 6);
}

function grabSword() {
  attackGrid = 0;
  attacking = false;
  hasSword = true;
}


function useAttack() {
  attackGrid = 1;
  player.invincible = true;
  player.canMove = false;
  enemyAttacking = false;
  hasSword = false;
  var tempPY = player.y;
  var tempPX = player.x;
  var playerApproaching = true;
  var i = 0;
  var attacknterval = setInterval(function() {
    i++;
    if (i == 7) {
      swiping = true;
    }
    if (i > 8) {
      playerApproaching = false;
    }
    if (i > 15) {
      clearInterval(attacknterval);
    }
    
    if (playerApproaching) {
      player.y = (tempPY * (8-i)/8) + (180 * i/8);
      player.x = (tempPX * (8-i)/8) + ((width/2) * i/8);
    } else {
      player.y = (tempPY * (i-8)/8) + (180 * (8-(i-8))/8);
      player.x = (tempPX * (i-8)/8) + ((width/2) * (8-(i-8))/8);
    }
  }, 50);
  
  setTimeout(function() {
    bossHp--;
    coinSpeed += 5;
    player.invincible = false;
    player.canMove = true;
    enemyAttacking = true;
    attacking = false;
  
    attackTurns = 0;
    if (bossHp <=0) {
      score += 100;
      score += 10 * player.hp;
      level = 10;
      if (soundOn) {
        audio0.pause();
      }
    }
  }, 1000);
}

var hurtByCard = false;

function throwCard() {
/*
  throwingCards = true;
  hurtByCard = false;
  cardX = boxes[8].x - 60;
  var tempCardY = Math.floor(Math.random() * (7 - 2 + 1) + 2);
  cardY = boxes[tempCardY].y;
  var ii = 0;
  var abc = setTimeout(function() {
    var cardThrowing = setInterval(function() {
      ii++;
      cardX = cardX + (3*ii);       
      if (ii > 20) {
        clearInterval(cardThrowing);
        throwingCards = false;
      }
      
    }, 100);
  }, 1000);
  */
}



function throwCoin() {

if (!throwingCoin && enemyAttacking) {
  throwingCoin = true;
  coinCount++;
  var i =0;

  // Determine where each coin will go
  for (i=0;i<coinCount;i++) {
    tempx[i] = Math.floor(Math.random() * (10) + 8);
    tempy[i] = Math.floor(Math.random() * (7) + 1);
    coinX[i] = width/2 - 60; 
    coinY[i] = 100;
    coinDestinationX[i] = boxes[tempx[i]].x;
    coinDestinationY[i] = boxes[tempy[i]].y;
    tempx[i] -= 8;
    tempy[i] -= 1;
    tempy[i] = Math.abs(tempy[i] - 6);
  }

  var ii = 0;
  var abc = setTimeout(function() {
      var coinThrowing = setInterval(function() {
        ii++;      
        for (i=0;i<coinCount;i++) {
          //coinX[i] = coinDestinationX[i] * (ii / coinSpeed);
          
          coinX[i] = ( ( width/2 - 60 ) * (coinSpeed - ii) / coinSpeed ) + (coinDestinationX[i] * (ii / coinSpeed));
          coinY[i] = ( 100 * (coinSpeed - ii) / coinSpeed ) + (coinDestinationY[i] * (ii / coinSpeed));
         // coinY[i] = coinDestinationY[i] * (ii / coinSpeed) ;
        }
              
        if (ii > coinSpeed) {
          clearInterval(coinThrowing);
          for (i=0;i<coinCount;i++) {
            coinX[i] = coinDestinationX[i];
            coinY[i] = coinDestinationY[i];
            gridTiles[tempx[i]][tempy[i]] = 1;
          }
          coinsPlaced = true;
          var def = setTimeout(function() {
            for (i=0;i<coinCount;i++) {
              gridTiles[tempx[i]][tempy[i]] = 0;
            }
            coinsPlaced = false;
            throwingCoin = false;
          }, 500);
          keys[90] = true;
          for (i=0;i<coinCount;i++) {
            if(player.gridY == tempy[i] && player.gridX == tempx[i]) {
              damagePlayer();
            }
          }
          if (coinSpeed > 5) {
            coinSpeed--;
          }
        }
      }, 50);
    }, coinSpeed * 20);        
  }
}



document.body.addEventListener("keydown", function (e) {
    keys[e.keyCode] = true;
});

document.body.addEventListener("keyup", function (e) {
    keys[e.keyCode] = false;
});


make_base();

function make_base()
{
  base_image = new Image();
  base_image.src = 'https://i.stack.imgur.com/zqElV.png?s=64&g=1';
  base_image.onload = function(){
    context.drawImage(base_image, 400, 400);
  }
}


function startGame() {
  update();
} 
window.addEventListener("load", function () {
    update();
});

var sound = false;

function soundOff() {
  audio.pause();
  audio0.pause();
  audio.currentTime = 0;
  audio0.currentTime = 0;
}
var audio = new Audio('https://SheePop-dev.github.io/Main_Menu.mp3');
var audio0 = new Audio('https://SheePop-dev.github.io/Battle_Theme.mp3');
function toggleSound() {
  if (soundOn) {
    if(sound) {
	  audio.pause();
      sound = false;
    } else {
      audio.play();
      audio.loop = true;
      sound = true;
    }
  }
}

</script>
</html>
